<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>git undo: We can do better</title>
  <meta name="description" content="Update for future readers: Are you looking for a way to undo something with Git? The git undo command won’t help with your current issue (it needs to be inst...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.waleedkhan.name/git-undo/">
  <link rel="alternate" type="application/rss+xml" title="Stenography and programming languages" href="https://blog.waleedkhan.name/feed.xml">
  <script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Stenography and programming languages</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">git undo: We can do better</h1>
    <p class="post-meta"><time datetime="2021-06-19T00:00:00-05:00" itemprop="datePublished">Jun 19, 2021</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    
    <p><strong>Update for future readers</strong>: Are you looking for a way to undo something with Git? The <code class="language-plaintext highlighter-rouge">git undo</code> command won’t help with your current issue (it needs to be installed ahead of time), but it can make dealing with future issues a lot easier. Try installing <a href="https://github.com/arxanas/git-branchless"><code class="language-plaintext highlighter-rouge">git-branchless</code></a>, and then see the <a href="https://github.com/arxanas/git-branchless/wiki/Command:-git-undo">documentation for <code class="language-plaintext highlighter-rouge">git undo</code></a>.</p>

<hr />

<ul id="markdown-toc">
  <li><a href="#motivation" id="markdown-toc-motivation">Motivation</a></li>
  <li><a href="#solution" id="markdown-toc-solution">Solution</a></li>
  <li><a href="#demos" id="markdown-toc-demos">Demos</a></li>
  <li><a href="#implementation" id="markdown-toc-implementation">Implementation</a></li>
</ul>

<h2 id="motivation">Motivation</h2>

<p>Git is a version control system with robust underlying principles, and yet, novice users are terrified of it. When they make a mistake, many would rather delete and re-clone the repository than try to fix it. Even proficient users can find wading through the reflog tedious.</p>

<p>Why? How is it so easy to “lose” your data in a system that’s supposed to never lose your data?</p>

<p>Well, it’s not that it’s too easy to lose your data — but rather, that it’s too difficult to recover it. For each operation you want to recover from, there’s a different “magic” incantation to undo it. All the data is still there in principle, but it’s not accessible to many in practice.</p>

<p>Here’s my theory: novice and intermediate users would significantly improve their understanding and efficacy with Git if they weren’t afraid of making mistakes.</p>

<h2 id="solution">Solution</h2>

<p>To address this problem, I offer <code class="language-plaintext highlighter-rouge">git undo</code>, <a href="https://github.com/arxanas/git-branchless">part of the git-branchless suite of tools</a>. To my knowledge, this is the most capable undo tool currently available for Git. For example, it can undo bad merges and rebases with ease, and there are even some rare operations that <code class="language-plaintext highlighter-rouge">git undo</code> can undo <a href="https://github.com/arxanas/git-branchless/wiki/Architecture#comparison-with-the-reflog">which can’t be undone with <code class="language-plaintext highlighter-rouge">git reflog</code></a>.</p>

<p><em>Update 2021-06-21</em>: <a href="https://news.ycombinator.com/item?id=27580659">user <code class="language-plaintext highlighter-rouge">gldnspud</code> on Hacker News</a> points out that the <a href="https://gitup.co/">GitUp</a> client also supports undo/redo via snapshots, also by adding additional plumbing on top of Git.</p>

<p>I’ve presented demos below, and briefly discussed the implementation at the end of the article. My hope is that by making it easier to fix mistakes, novice Git users will be able to experiment more freely and learn more effectively.</p>

<h2 id="demos">Demos</h2>

<p>Undoing an amended commit:</p>

<script id="asciicast-2T3MdVSJVlGcK73Yl5YRXbSGK" src="https://asciinema.org/a/2T3MdVSJVlGcK73Yl5YRXbSGK.js" async=""></script>

<noscript><a href="https://asciinema.org/a/2T3MdVSJVlGcK73Yl5YRXbSGK" target="_blank"><img src="https://asciinema.org/a/2T3MdVSJVlGcK73Yl5YRXbSGK.svg" /></a></noscript>

<p>Undoing a merge conflict that was resolved wrongly:</p>

<script id="asciicast-ziVoTyp4390RaKsdcdNj2gI0Q" src="https://asciinema.org/a/ziVoTyp4390RaKsdcdNj2gI0Q.js" async=""></script>

<noscript><a href="https://asciinema.org/a/ziVoTyp4390RaKsdcdNj2gI0Q" target="_blank"><img src="https://asciinema.org/a/ziVoTyp4390RaKsdcdNj2gI0Q.svg" /></a></noscript>

<h2 id="implementation">Implementation</h2>

<p><code class="language-plaintext highlighter-rouge">git undo</code> is made possible by a recent addition to Git: the <code class="language-plaintext highlighter-rouge">reference-transaction</code> hook. This hook triggers whenever a change is made to a reference, such as a branch. By recording all reference moves, we can rebuild the state of the commit graph at any previous point in time. Then we accomplish the undo operation by restoring all references to their previous positions in time (possibly creating or deleting references in the process).</p>

<p>I originally built <code class="language-plaintext highlighter-rouge">git-branchless</code> in order to replicate a certain Mercurial workflow, but the data structures turn out to be flexible enough to give us a <code class="language-plaintext highlighter-rouge">git undo</code> feature nearly for free. You can find more detail at the <a href="https://github.com/arxanas/git-branchless/wiki/Architecture">Architecture</a> page for the project.</p>

  </div>

</article>


<span class="hacker-news"><a href="https://news.ycombinator.com/item?id=27579701 ">Discussion on Hacker News</a></span>





<div id="disqus_thread"></div>
<script>

/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
var disqus_config = function () {
    this.page.url = "https://blog.waleedkhan.name/git-undo/";
    this.page.identifier = "git-undo/";
};

(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//waleedkhan-name.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Stenography and programming languages</h2>
    <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Waleed Khan</li>
          <li><a href="mailto:me@waleedkhan.name">me@waleedkhan.name</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/arxanas"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">arxanas</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>This is a personal blog. Unless otherwise stated, the opinions
expressed here are my own, and not those of my past or present
employers.</p>
      </div>
    </div>

  </div>

  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53066274-1', 'auto');
ga('send', 'pageview');
</script>



</footer>


  </body>

</html>
